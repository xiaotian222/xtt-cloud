<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="xtt.cloud.oa.platform.domain.mapper.UserDepartmentMapper">

    <resultMap id="DepartmentResultMap" type="xtt.cloud.oa.platform.domain.entity.Department">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="parent_id" property="parentId" jdbcType="BIGINT"/>
        <result column="name" property="name" jdbcType="VARCHAR"/>
        <result column="sort_no" property="sortNo" jdbcType="INTEGER"/>
        <result column="created_at" property="createdAt" jdbcType="TIMESTAMP"/>
        <result column="updated_at" property="updatedAt" jdbcType="TIMESTAMP"/>
    </resultMap>

    <select id="selectDepartmentsByUserId" parameterType="java.lang.Long" resultMap="DepartmentResultMap">
        SELECT d.id, d.parent_id, d.name, d.sort_no, d.created_at, d.updated_at
        FROM sys_dept d
        INNER JOIN sys_user_dept ud ON d.id = ud.dept_id
        WHERE ud.user_id = #{userId}
        ORDER BY d.sort_no ASC, d.created_at ASC
    </select>

    <select id="selectUserIdsByDepartmentId" parameterType="java.lang.Long" resultType="java.lang.Long">
        SELECT user_id
        FROM sys_user_dept
        WHERE dept_id = #{departmentId}
    </select>

    <insert id="insertUserDepartment">
        INSERT INTO sys_user_dept (user_id, dept_id)
        VALUES (#{userId}, #{departmentId})
    </insert>

    <delete id="deleteUserDepartments" parameterType="java.lang.Long">
        DELETE FROM sys_user_dept WHERE user_id = #{userId}
    </delete>

    <delete id="deleteDepartmentUsers" parameterType="java.lang.Long">
        DELETE FROM sys_user_dept WHERE dept_id = #{departmentId}
    </delete>

    <insert id="insertUserDepartments">
        INSERT INTO sys_user_dept (user_id, dept_id)
        VALUES
        <foreach collection="departmentIds" item="departmentId" separator=",">
            (#{userId}, #{departmentId})
        </foreach>
    </insert>

</mapper>
